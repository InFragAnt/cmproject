<collection name="Seminars_(pp_cmj_all)" idField="id" replace="runtime">
    <prototype>
        <![CDATA[Select
	id,
	created_date,
	updated_date,
	Module,
	self_1,
	self_2,
	self_3,
	nameSem,
	veduschiy,
	participants,
	place,
	dataivremya,
	materials
from
	(
	select
		rkkbase.id,
		rkkbase.created_date,
		rkkbase.updated_date,
		rkkbase.module as module,
		rkkbase.subject as subject,
		'<id>' as self_1,
		':' as self_2,
		'</>' as self_3,
		(
		select
			tfs."value" as v
		from
			tn_field
		join tn_field_string tfs on
			tn_field.access_object_id = tfs.id
		where
			tn_field."owner" = rkkbase.id
			and tn_field.owner_type = rkkbase.id_type
			and tn_field.cmjfield = 'nameSem') as nameSem,
		coalesce((SELECT  string_agg(SPLIT_PART(tfs.value, '%', 1),',') AS v
 FROM tn_field
 JOIN tn_field_string tfs ON tn_field.access_object_id = tfs.id
 WHERE tn_field."owner" = rkkbase.id AND tn_field.cmjfield = 'Tn$_veduschiy'),'Не 1 указано'
) AS veduschiy,
		coalesce((SELECT  string_agg(SPLIT_PART(tfs.value, '%', 1),',') AS v
 FROM tn_field
 JOIN tn_field_string tfs ON tn_field.access_object_id = tfs.id
 WHERE tn_field."owner" = rkkbase.id AND tn_field.cmjfield = 'Tn$_participants'),'Не 2 указано'
) AS participants,
			(
		select
			tfs."value" as v
		from
			tn_field
		join tn_field_string tfs on
			tn_field.access_object_id = tfs.id
		where
			tn_field."owner" = rkkbase.id
			and tn_field.owner_type = rkkbase.id_type
			and tn_field.cmjfield = 'place') as place,
			(
		select tfs."value" as v
from tn_field
join tn_field_datetime  tfs on tn_field.access_object_id = tfs.id
where tn_field."owner" = rkkbase.id and tn_field.owner_type = rkkbase.id_type
and tn_field.cmjfield = 'Tn$_dataivremya') as dataivremya,
		(
		select
			tfs."value" as v
		from
			tn_field
		join tn_field_string tfs on
			tn_field.access_object_id = tfs.id
		where
			tn_field."owner" = rkkbase.id
			and tn_field.owner_type = rkkbase.id_type
			and tn_field.cmjfield = 'materials') as materials
	from
		F_DP_Intrkk internalrkk
	join f_dp_rkk rkk on
		rkk.id = internalrkk.id
	join f_dp_rkkbase rkkbase on
		rkkbase.id = rkk.id
	where
		rkkbase.isdeleted <> 1) s
where 1=1
             ::where-clause
            ]]>
    </prototype>
    <counting-prototype>
        <![CDATA[
            SELECT
				COUNT(1)
                FROM (
                       select
	rkkbase.id,
    rkkbase.created_date,
    rkkbase.updated_date,
    rkkbase.module                                   AS Module,
    '<id>'                                           AS self_1,
    ':'                                              AS self_2,
    '</>'                                            AS self_3
	FROM F_DP_Intrkk internalrkk
                  JOIN f_dp_rkk rkk ON rkk.id = internalrkk.id
                  JOIN f_dp_rkkbase rkkbase ON rkkbase.id = rkk.id
                  JOIN F_DP_Intrkk_Executor executor ON executor.owner = internalrkk.id
                  JOIN so_beard beard ON beard.id = executor.executor
         WHERE rkkbase.isdeleted <> 1
           AND rkk.regnumcnt IS NULL
		   ) s
                WHERE 1=1 ::where-clause
            ]]>
    </counting-prototype>
    <filter name="MODULE">
        <criteria placeholder="where-clause">
            <![CDATA[
                    Module = {0}
                ]]>
        </criteria>
    </filter>
    <filter name="self">
        <criteria placeholder="where-clause"><![CDATA[ Module = {0} and id = {1} ]]></criteria>
    </filter>
    <filter name="created_date">
        <criteria placeholder="where-clause">
            <![CDATA[
                   cast(created_date as date) = cast({0} as date)
                ]]>
        </criteria>
    </filter>
    <filter name="nameSem">
       <!--  <criteria placeholder="where-clause">  </criteria>  -->
            <![CDATA[
                   nameSem = {0}
                ]]>

    </filter>
    <filter name="veduschiy">
        <![CDATA[
                   veduschiy = {0}
                ]]>
    </filter>

    <filter name="participants">
        <![CDATA[
                   participants = {0}
                ]]>
    </filter>
    <filter name="place">
        <![CDATA[
                   place = {0}
                ]]>
    </filter>
    <filter name="dataivremya">
        <![CDATA[
                   dataivremya = {0}
                ]]>
    </filter>
    <filter name="materials">
        <![CDATA[
                   materials = {0}
                ]]>
    </filter>
</collection>